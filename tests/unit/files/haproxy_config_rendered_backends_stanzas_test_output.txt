
backend backend-site1-local
    option httpchk HEAD /?token=1868572800_4eb30fc94f247635f7ed445083a4783862ad58de HTTP/1.0\r\nHost:\ site1.local\r\nUser-Agent:\ haproxy/httpchk
    http-request set-header Host site1.local
    balance leastconn
    server server_1 127.0.1.10:80 check inter 5000 rise 2 fall 5 maxconn 16
    server server_2 127.0.1.11:80 check inter 5000 rise 2 fall 5 maxconn 16
    server server_3 127.0.1.12:80 check inter 5000 rise 2 fall 5 maxconn 16

backend backend-site2-local
    option httpchk GET /check/ HTTP/1.0\r\nHost:\ site2.local\r\nUser-Agent:\ haproxy/httpchk
    http-request set-header Host site2.local
    balance leastconn
    server server_1 127.0.1.10:443 check inter 5000 rise 2 fall 5 maxconn 16 ssl sni str(site2.local) check-sni site2.local verify required ca-file ca-certificates.crt
    server server_2 127.0.1.11:443 check inter 5000 rise 2 fall 5 maxconn 16 ssl sni str(site2.local) check-sni site2.local verify required ca-file ca-certificates.crt
    server server_3 127.0.1.12:443 check inter 5000 rise 2 fall 5 maxconn 16 ssl sni str(site2.local) check-sni site2.local verify required ca-file ca-certificates.crt

backend backend-site3-local
    option forwardfor except 127.0.0.1
    option forceclose
    option httpchk HEAD / HTTP/1.0\r\nHost:\ site3.local\r\nUser-Agent:\ haproxy/httpchk
    http-request set-header Host site3.local
    balance leastconn
    server server_1 127.0.1.10:80 check inter 5000 rise 2 fall 5 maxconn 16
    server server_2 127.0.1.11:80 check inter 5000 rise 2 fall 5 maxconn 16
    server server_3 127.0.1.12:80 check inter 5000 rise 2 fall 5 maxconn 16

backend backend-site5
    option httpchk HEAD / HTTP/1.0\r\nHost:\ site5.local\r\nUser-Agent:\ haproxy/httpchk
    http-request set-header Host site5.local
    balance leastconn
    server server_1 127.0.1.10:80 check inter 5000 rise 2 fall 5 maxconn 16

backend backend-site5-2
    option httpchk HEAD / HTTP/1.0\r\nHost:\ site5.local\r\nUser-Agent:\ haproxy/httpchk
    http-request set-header Host site5.local
    balance leastconn
    server server_1 127.0.1.11:80 check inter 5000 rise 2 fall 5 maxconn 16
